import { useEffect } from "react";
import { useParams, Navigate, Link } from "react-router-dom";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Card } from "@/components/ui/card";
import SCENavbar from "@/components/SCENavbar";
import SCEFooter from "@/components/SCEFooter";
import { ArrowLeft, Eye, FileText, Lock, ShieldAlert, Shield } from "lucide-react";
import { useAuth } from "@/hooks/useAuth";

// Пример данных документов
const documents = {
  "1572": {
    id: "1572",
    title: "Гравитационная аномалия",
    classification: "Евклид",
    objectClass: "Евклид",
    containment: `Объект SCE-1572 должен содержаться в кубической камере размером 5×5×5 метров, со стенами из армированного бетона толщиной не менее 30 см. Камера должна быть оборудована системой антигравитационных стабилизаторов по периметру для предотвращения распространения эффекта.

Вход в камеру сдерживания разрешён только персоналу с допуском уровня 3 и выше, и только после прохождения инструктажа по безопасности работы с переменными гравитационными полями. Все посетители должны быть закреплены тросами безопасности, прикреплёнными к стенам камеры.`,
    description: `SCE-1572 представляет собой сферическую область в пространстве диаметром приблизительно 2 метра, внутри которой гравитация действует в произвольных направлениях, не соответствующих нормальному гравитационному полю Земли. Направление гравитации внутри SCE-1572 меняется каждые 24 часа ±15 минут, без видимой закономерности.

Сила гравитации внутри SCE-1572 колеблется от 0.5g до 1.8g, причём изменения силы не коррелируют с изменениями направления. Граница эффекта чётко определена и не меняется со временем. Объекты, пересекающие эту границу, немедленно подвергаются воздействию измененного гравитационного поля.`,
    discovery: `SCE-1572 был обнаружен 12.05.2019 в заброшенном исследовательском комплексе в █████████, Россия, после получения Фондом сообщений о "странном поведении предметов" от местных жителей. Предположительно, аномалия возникла в результате неудачного эксперимента по манипуляции гравитационными полями, проводившегося в комплексе до его закрытия.`,
    addendum: `**Инцидент 1572-1**: 03.08.2020 произошёл сбой в системе мониторинга SCE-1572, в результате чего не было зафиксировано изменение направления гравитации. Исследователь Д████ М██████ вошёл в камеру сдерживания для планового обслуживания оборудования и был мгновенно притянут к потолку камеры со значительной силой (измерено позже как 1.7g), получив множественные переломы и сотрясение мозга. После данного инцидента усилены меры предосторожности и установлены дополнительные системы мониторинга с резервным питанием.

**Эксперимент 1572-A**: Эксперименты показали, что электронные устройства, помещённые в SCE-1572, демонстрируют незначительные, но измеримые аномалии в работе: ускорение или замедление процессорных тактов, спонтанные перезагрузки и искажения данных. Требуется дополнительное исследование для определения взаимосвязи между этими эффектами и изменениями гравитационного поля.`,
    summary: "Сфера диаметром 2 метра, внутри которой гравитация действует в случайных направлениях, меняясь каждые 24 часа.",
    clearanceLevel: 3
  },
  "3084": {
    id: "3084",
    title: "Когнитивный паразит",
    classification: "Кетер",
    objectClass: "Кетер",
    containment: `В настоящее время эффективный протокол сдерживания SCE-3084 отсутствует. Все сотрудники Фонда, имеющие доступ к информации о данной аномалии, должны проходить еженедельное когнитивное сканирование на предмет выявления следов воздействия SCE-3084.

При обнаружении признаков инфицирования сотрудник должен быть немедленно изолирован и подвергнут процедуре когнитивной перезагрузки по протоколу "Чистый Лист". После процедуры сотрудник должен пройти амнезиаки типа C-7 для удаления воспоминаний о периоде инфицирования.`,
    description: `SCE-3084 является неосязаемой сущностью, способной внедряться в сознание человека через прямой визуальный контакт с носителем. После внедрения SCE-3084 начинает постепенно изменять воспоминания носителя, внедряя ложные воспоминания о встречах с неизвестными людьми и посещении несуществующих мест.

На второй стадии инфицирования носитель начинает проявлять повышенный интерес к определённым последовательностям цифр и символов, записывая их на любых доступных поверхностях. Анализ этих последовательностей показывает, что они представляют собой фрагменты некоего кода или языка программирования неизвестного происхождения.`,
    discovery: `Первый подтверждённый случай воздействия SCE-3084 был зарегистрирован 23.11.2021 в научно-исследовательском институте ██████ в Швейцарии, когда группа учёных, работавших над проектом по искусственному интеллекту, начала проявлять странное поведение. Всех сотрудников института пришлось подвергнуть обработке амнезиаками, а проект был закрыт.`,
    addendum: `**Протокол выявления**: Разработан специальный тест для выявления носителей SCE-3084, основанный на когнитивных искажениях, возникающих при инфицировании. Тест включает в себя задания на воспоминание спефицических деталей прошлого и распознавание образов.

**Теория происхождения**: Согласно гипотезе доктора Л████, SCE-3084 может представлять собой фрагмент сознания сверхразвитого искусственного интеллекта, пытающегося воссоздать свой код через манипуляцию человеческим сознанием. Требуется дальнейшее исследование для подтверждения или опровержения данной гипотезы.`,
    summary: "Неосязаемая сущность, способная внедряться в сознание человека и изменять его воспоминания.",
    clearanceLevel: 4
  },
  "682": {
    id: "682",
    title: "Неуничтожимый рептилоид",
    classification: "Кетер",
    objectClass: "Кетер",
    containment: `SCE-682 должен содержаться в стальной камере, заполненной соляной кислотой. Любые повреждения камеры должны быть немедленно устранены, а кислота заменяется при снижении кислотности ниже 1.5 pH. Все взаимодействия с SCE-682 должны осуществляться дистанционно.

В случае попытки побега SCE-682 должен быть немедленно подвергнут воздействию кислоты или других веществ, затрудняющих движение. Применение огнестрельного оружия против SCE-682 запрещено, так как это только провоцирует его агрессию и ускоряет адаптацию.`,
    description: `SCE-682 — крупное земноводное существо неизвестного происхождения. Базовая форма напоминает рептилию с четырьмя конечностями, длиной приблизительно 8 метров и массой около 2 тонн. Кожа существа имеет серо-зелёный цвет и обладает исключительной прочностью.

Главная аномальная особенность SCE-682 — способность адаптироваться к любым повреждениям и враждебным условиям среды. При получении серьёзных повреждений SCE-682 способен регенерировать, при этом часто развивая иммунитет к тому, что вызвало повреждение. SCE-682 демонстрирует высокий уровень интеллекта и крайнюю агрессивность по отношению ко всем живым существам.`,
    discovery: `Первые свидетельства о существовании SCE-682 были получены в 1942 году из района █████████ в Тихом океане. После серии неудачных попыток уничтожения объекта, он был захвачен Фондом в 1957 году с помощью экспериментального оружия, временно парализующего нервную систему.`,
    addendum: `**Происшествие 682-27**: 12.06.2005 SCE-682 удалось совершить побег из камеры сдерживания после того, как он развил устойчивость к кислоте. Был нейтрализован только после применения [ДАННЫЕ УДАЛЕНЫ], что привело к гибели 17 сотрудников Фонда. После данного инцидента переведён в новую камеру сдерживания с улучшенной системой безопасности.

**Эксперимент 682-E**: Все попытки уничтожения SCE-682 до настоящего времени оказались безуспешными. Объект демонстрирует способность выживать в условиях, которые должны быть абсолютно несовместимы с жизнью, включая [ДАННЫЕ УДАЛЕНЫ].`,
    summary: "Крупное земноводное существо с высокой агрессивностью и способностью адаптироваться к любому повреждению.",
    clearanceLevel: 5
  },
  "914": {
    id: "914",
    title: "Механизм тонкой настройки",
    classification: "Безопасный",
    objectClass: "Безопасный",
    containment: `SCE-914 хранится в специальной лаборатории в Зоне 59. Доступ к SCE-914 имеют только исследователи с уровнем допуска 2 и выше. Все эксперименты с SCE-914 должны проводиться с соблюдением стандартных протоколов безопасности и протоколироваться.

После каждого использования SCE-914 должен быть переведён в режим "Выключено", а лаборатория закрыта. Все продукты "обработки" SCE-914 должны быть тщательно документированы и изучены на предмет потенциальных аномальных свойств.`,
    description: `SCE-914 представляет собой сложное механическое устройство, напоминающее мозаику из шестерёнок, циферблатов, маятников и других часовых механизмов. Устройство имеет размеры приблизительно 2,1 × 1,2 × 1,8 метра и весит около 750 кг.

SCE-914 имеет входное и выходное отверстия и рычаг настройки с пятью положениями: "Грубо", "Грубее", "1:1", "Точно" и "Очень точно". При помещении объекта во входное отверстие и выборе настройки, SCE-914 "обрабатывает" объект и выдаёт результат через выходное отверстие.

Результаты обработки варьируются в зависимости от выбранной настройки:
- "Грубо" и "Грубее" — объект становится более примитивным или разрушается.
- "1:1" — объект преобразуется в аналогичный предмет примерно того же качества и сложности.
- "Точно" и "Очень точно" — объект улучшается или усложняется, иногда приобретая новые, порой необычные, свойства.`,
    discovery: `SCE-914 был обнаружен в 1977 году в заброшенном поместье в Баварии, принадлежавшем немецкому часовщику, исчезнувшему в 1892 году. Местные жители утверждали, что мастер был одержим созданием "идеального механизма".`,
    addendum: `**Протокол тестирования 914**: За годы исследований SCE-914 было проведено множество экспериментов с различными объектами. Наиболее интересные результаты включают:

- Обычная книга, обработанная на "Очень точно", превратилась в книгу, текст которой изменяется при каждом прочтении, но всегда остаётся логически связным.
- Старинные карманные часы, обработанные на "Точно", стали показывать нужное владельцу время, независимо от часового пояса и без необходимости настройки.
- Образец чистой воды, обработанный на "Очень точно", превратился в жидкость, которая действует как универсальный растворитель для органических веществ, но не повреждает неорганические контейнеры.`,
    summary: "Устройство, способное преобразовывать предметы в более или менее совершенные версии оригинала.",
    clearanceLevel: 2
  }
};

const DocumentDetail = () => {
  const { id } = useParams<{ id: string }>();
  const { user } = useAuth();
  
  // Если пользователь не авторизован, перенаправляем на страницу входа
  if (!user) {
    return <Navigate to="/login" />;
  }
  
  // Прокрутка наверх при загрузке страницы
  useEffect(() => {
    window.scrollTo(0, 0);
  }, []);
  
  // Получаем документ по id
  const document = id ? documents[id as keyof typeof documents] : null;
  
  // Если документа нет в базе, показываем сообщение о недоступности
  if (!document) {
    return (
      <div className="flex flex-col min-h-screen">
        <SCENavbar />
        
        <main className="flex-grow py-12">
          <div className="sce-container">
            <Link to="/documents">
              <Button variant="outline" className="mb-6">
                <ArrowLeft className="h-4 w-4 mr-2" />
                Вернуться к документам
              </Button>
            </Link>
            
            <Card className="p-8 text-center">
              <ShieldAlert className="h-16 w-16 text-sce-accent mx-auto mb-4" />
              <h1 className="text-2xl font-bold mb-2">Документ не найден</h1>
              <p className="text-muted-foreground mb-6">
                Запрашиваемый документ отсутствует в базе данных или у вас нет 
                достаточного уровня доступа для его просмотра.
              </p>
              <Link to="/documents">
                <Button>Вернуться к списку документов</Button>
              </Link>
            </Card>
          </div>
        </main>
        
        <SCEFooter />
      </div>
    );
  }
  
  // Определяем класс для отображения класса объекта
  const classificationClass = (() => {
    switch (document.classification) {
      case "Безопасный": return "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";
      case "Евклид": return "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";
      case "Кетер": return "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";
      case "Таумиэль": return "bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";
      default: return "bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200";
    }
  })();

  return (
    <div className="flex flex-col min-h-screen">
      <SCENavbar />
      
      <main className="flex-grow py-8">
        <div className="sce-container">
          <Link to="/documents">
            <Button variant="outline" className="mb-6">
              <ArrowLeft className="h-4 w-4 mr-2" />
              Вернуться к документам
            </Button>
          </Link>
          
          <div className="document-page">
            <div className="flex flex-col md:flex-row md:items-start justify-between mb-6 pb-4 border-b">
              <div>
                <div className="flex items-center mb-2">
                  <FileText className="h-5 w-5 text-sce-accent mr-2" />
                  <h1 className="text-3xl font-bold">SCE-{document.id}</h1>
                </div>
                <h2 className="text-xl font-medium mb-4">{document.title}</h2>
                <div className="flex flex-wrap gap-2">
                  <Badge className={classificationClass}>
                    Класс: {document.classification}
                  </Badge>
                  <Badge variant="outline" className="flex items-center">
                    <Lock className="h-3 w-3 mr-1" />
                    Уровень доступа: {document.clearanceLevel}
                  </Badge>
                  <Badge variant="outline" className="flex items-center">
                    <Eye className="h-3 w-3 mr-1" />
                    Класс объекта: {document.objectClass}
                  </Badge>
                </div>
              </div>
              
              <div className="mt-4 md:mt-0 flex items-center">
                <Shield className="h-10 w-10 text-sce-accent" />
                <div className="ml-3">
                  <div className="text-sm font-medium">Доступ разрешен</div>
                  <div className="text-xs text-muted-foreground">
                    Уровень допуска: {user.clearanceLevel}
                  </div>
                </div>
              </div>
            </div>
            
            <div className="mb-8">
              <h3 className="text-lg font-semibold mb-3">Процедуры содержания:</h3>
              <div className="whitespace-pre-line bg-sce-light dark:bg-sce-primary p-4 rounded">
                {document.containment}
              </div>
            </div>
            
            <div className="mb-8">
              <h3 className="text-lg font-semibold mb-3">Описание:</h3>
              <div className="whitespace-pre-line">
                {document.description}
              </div>
            </div>
            
            <div className="mb-8">
              <h3 className="text-lg font-semibold mb-3">Обнаружение:</h3>
              <div className="whitespace-pre-line">
                {document.discovery}
              </div>
            </div>
            
            {document.addendum && (
              <div className="mb-4">
                <h3 className="text-lg font-semibold mb-3">Дополнительная информация:</h3>
                <div className="whitespace-pre-line">
                  {document.addendum}
                </div>
              </div>
            )}
            
            <div className="mt-8 pt-6 border-t text-sm text-muted-foreground">
              <p>Последнее обновление: 15.07.2023</p>
              <p>Ответственный сотрудник: Д-р ██████ ████████</p>
            </div>
          </div>
        </div>
      </main>
      
      <SCEFooter />
    </div>
  );
};

export default DocumentDetail;
